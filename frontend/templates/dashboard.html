{% extends "base.html" %}

{% block title %}
    <title>EcoHealth - Dashboard</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="dashboard-wrapper">
    <header class="hero">
        <div class="hero-content">
            <h1 class="hero-title">Welcome, {{ username }}</h1>
            <p class="hero-subtitle">Your Digital Twin Dashboard</p>
        </div>
    </header>

    <!-- Dashboard Navigation -->
    <nav class="dashboard-navigation">
        <a href="#overview-section" class="dashboard-link">üåü Overview</a>
        <a href="#simulation-section" class="dashboard-link">üõ†Ô∏è Simulations</a>
        <a href="{{ url_for('logout') }}" class="dashboard-link">üö™ Logout</a>
    </nav>

    <!-- Main Dashboard Content -->
    <div class="dashboard-content">
        <!-- Left Panel -->
        <section id="overview-section">
            <div class="score-card">
                <h3>üåø Environmental Impact</h3>
                <p class="main-score">{{ twin_state.environmental.overall_score }}/100</p>
                <ul class="sub-scores">
                    <li>Transportation: {{ twin_state.environmental.transportation.score }}/100</li>
                    <li>Diet: {{ twin_state.environmental.diet.score }}/100</li>
                    <li>Consumption: {{ twin_state.environmental.consumption.score }}/100</li>
                </ul>
            </div>

            <div class="score-card">
                <h3>‚ù§Ô∏è Health Status</h3>
                <p class="main-score">{{ twin_state.health.overall_score }}/100</p>
                <ul class="sub-scores">
                    <li>Exercise: {{ twin_state.health.exercise.score }}/100</li>
                    <li>Sleep: {{ twin_state.health.sleep.score }}/100</li>
                    <li>Wellness: {{ twin_state.health.wellness.score }}/100</li>
                </ul>
            </div>

            <div class="score-card">
                <h3>üåç Carbon Footprint</h3>
                <p class="main-score">{{ twin_state.carbon_footprint }} tons/year</p>
                <p>Compared to global average: 4 tons/year</p>
            </div>
        </section>

        <!-- Center Panel - 3D Model -->
        <div id="container"></div>

        <!-- Right Panel -->
        <section id="simulation-section">
            <div class="simulation-container">
                <h3>What-If Scenarios</h3>
                <label for="change-type">Change Type:</label>
                <select id="change-type" class="simulation-input">
                    <option value="transportation">Transportation</option>
                    <option value="diet">Diet</option>
                    <option value="exercise">Exercise</option>
                </select>

                <label for="change-description">Describe Your Change:</label>
                <input type="text" 
                       id="change-description" 
                       class="simulation-input"
                       placeholder="e.g., Use public transit 3 days/week">

                <button class="simulation-button">Simulate Impact</button>
            </div>

            <div id="simulation-results" class="score-card" style="display: none;">
                <!-- Results will be populated dynamically -->
            </div>
        </section>
    </div>
</div>

<!-- Pass template variables to JavaScript -->
<script>
    window.INITIAL_DATA = {
        healthScore: {{ twin_state.health.overall_score }},
        ecoScore: {{ twin_state.environmental.overall_score }},
        modelPath: "{{ url_for('static', filename='models/BreathingIdle.fbx') }}"
    };
</script>

<!-- Three.js imports -->
<script type="importmap">
    {
        "imports": {
            "three": "https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/"
        }
    }
</script>

<!-- Load dashboard JavaScript -->
<script type="module" src="{{ url_for('static', filename='js/dashboard.js') }}"></script>

{% endblock %}