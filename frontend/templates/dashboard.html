{% extends "base.html" %}

{% block content %}

<!-- Hero Section -->
<header class="hero dashboard-hero">
    
    <div class="hero-content">
        <h1 class="hero-title">Welcome, {{ username }}</h1>
        <p class="hero-subtitle">Explore your Digital Twin Dashboard</p>
    </div>
    <div class="hero-animations">
        <div class="animated-circle"></div>
        <div class="animated-circle2"></div>
        <div class="animated-circle3"></div>
        <div class="animated-circle4"></div>
    </div>
</header>

<main>
    <!-- Dashboard Navigation -->
    <section id="dashboard-navigation" class="features-section dashboard-navigation">
        <a href="#overview-section" class="feature dashboard-link">üåü Overview</a>
        <a href="#simulation-section" class="feature dashboard-link">üõ†Ô∏è Simulations</a>
        <a href="{{ url_for('logout') }}" class="feature logout-button">üö™ Logout</a>
    </section>

    <!-- Overview Section -->
    <section id="overview-section" class="dashboard-section scroll-triggered">
        <h2>Overview</h2>
        <div class="chart-grid">
            <div class="chart-container">
                <canvas id="radarChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="environmentalChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="healthChart"></canvas>
            </div>
        </div>
        <div class="score-cards">
            <!-- Environmental Score Card -->
            <div class="score-card feature">
                <h3>üåø Environmental Score</h3>
                <p class="main-score">{{ "%.1f"|format(twin_state.environmental.overall_score) }}/100</p>
                <div class="sub-scores">
                    <div class="sub-score">
                        <span>Transportation:</span>
                        <span>{{ "%.1f"|format(twin_state.environmental.transportation.score) }}/100</span>
                    </div>
                    {% if twin_state.environmental.transportation.key_factors %}
                    <div class="key-factors">
                        <span class="factor-label">Key Factors:</span>
                        <ul>
                            {% for factor in twin_state.environmental.transportation.key_factors %}
                            <li>{{ factor }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}

                    <div class="sub-score">
                        <span>Diet:</span>
                        <span>{{ "%.1f"|format(twin_state.environmental.diet.score) }}/100</span>
                    </div>
                    {% if twin_state.environmental.diet.key_factors %}
                    <div class="key-factors">
                        <span class="factor-label">Key Factors:</span>
                        <ul>
                            {% for factor in twin_state.environmental.diet.key_factors %}
                            <li>{{ factor }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}

                    <div class="sub-score">
                        <span>Consumption:</span>
                        <span>{{ "%.1f"|format(twin_state.environmental.consumption.score) }}/100</span>
                    </div>
                    {% if twin_state.environmental.consumption.key_factors %}
                    <div class="key-factors">
                        <span class="factor-label">Key Factors:</span>
                        <ul>
                            {% for factor in twin_state.environmental.consumption.key_factors %}
                            <li>{{ factor }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Health Score Card -->
            <div class="score-card feature">
                <h3>‚ù§Ô∏è Health Score</h3>
                <p class="main-score">{{ "%.1f"|format(twin_state.health.overall_score) }}/100</p>
                <div class="sub-scores">
                    <div class="sub-score">
                        <span>Exercise:</span>
                        <span>{{ "%.1f"|format(twin_state.health.exercise.score) }}/100</span>
                    </div>
                    {% if twin_state.health.exercise.key_factors %}
                    <div class="key-factors">
                        <span class="factor-label">Key Factors:</span>
                        <ul>
                            {% for factor in twin_state.health.exercise.key_factors %}
                            <li>{{ factor }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}

                    <div class="sub-score">
                        <span>Sleep:</span>
                        <span>{{ "%.1f"|format(twin_state.health.sleep.score) }}/100</span>
                    </div>
                    {% if twin_state.health.sleep.key_factors %}
                    <div class="key-factors">
                        <span class="factor-label">Key Factors:</span>
                        <ul>
                            {% for factor in twin_state.health.sleep.key_factors %}
                            <li>{{ factor }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}

                    <div class="sub-score">
                        <span>Wellness:</span>
                        <span>{{ "%.1f"|format(twin_state.health.wellness.score) }}/100</span>
                    </div>
                    {% if twin_state.health.wellness.key_factors %}
                    <div class="key-factors">
                        <span class="factor-label">Key Factors:</span>
                        <ul>
                            {% for factor in twin_state.health.wellness.key_factors %}
                            <li>{{ factor }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Carbon Footprint Card -->
            <div class="score-card feature">
                <h3>üåç Carbon Footprint</h3>
                <p class="main-score">{{ "%.1f"|format(twin_state.carbon_footprint) }} tons/year</p>
                <p class="comparison">Global Average: 4 tons/year</p>
                {% if twin_state.combined_score %}
                <div class="combined-score">
                    <span>Combined Score:</span>
                    <span>{{ "%.1f"|format(twin_state.combined_score) }}/100</span>
                </div>
                {% endif %}
            </div>
        </div>
    </section>

    <section id="health-analysis-section" class="dashboard-section scroll-triggered">
        <h2>Wellness Analysis</h2>
        <div class="wellness-container">
            <div class="webcam-container">
                <video id="webcam" playsinline autoplay></video>
                <canvas id="webcam-canvas" style="display: none;"></canvas>
                <div class="capture-controls">
                    <button id="start-camera" class="cta-button camera-button">
                        üìπ Start Camera
                    </button>
                    <button id="capture-image" class="cta-button capture-button" disabled>
                        üì∏ Capture & Analyze
                    </button>
                </div>
            </div>
            <div class="analysis-results" id="analysis-results">
                <div class="results-container">
                    <h3>Wellness Insights</h3>
                    <div id="loading-analysis" class="loading-spinner" style="display: none;">
                        <div class="spinner"></div>
                        <p>Analyzing wellness factors...</p>
                    </div>
                    <div id="analysis-content">
                        <!-- Results will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="recommendations-section" class="dashboard-section scroll-triggered">
        <h2>Smart Recommendations</h2>
        <div class="recommendations-container">
            <div class="recommendations-grid" id="recommendations-grid">
                <!-- Recommendations will be populated here -->
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p>Loading recommendations...</p>
                </div>
            </div>
            <button id="refresh-recommendations" class="cta-button recommendations-button">
                ‚Üª Refresh Recommendations
            </button>
        </div>
    </section>

    <!-- Simulation Section -->
    <!-- Replace the existing simulation section in dashboard.html -->
<section id="simulation-section" class="dashboard-section scroll-triggered">
    <h2>What-If Simulations</h2>
    <div class="simulation-container feature">
        <form id="simulation-form" class="space-y-4">
            <div class="form-group">
                <label for="change-type">Change Type:</label>
                <select id="change-type" name="change-type" class="simulation-input" required>
                    <option value="transportation">Transportation</option>
                    <option value="diet">Diet</option>
                    <option value="exercise">Exercise</option>
                </select>
            </div>
            <div class="form-group">
                <label for="change-description">Proposed Change:</label>
                <input type="text" 
                       id="change-description" 
                       name="change-description"
                       class="simulation-input" 
                       placeholder="e.g., Use public transit 3 days/week"
                       required>
            </div>
            <button type="submit" class="cta-button simulation-button">
                Simulate Impact
            </button>
        </form>
    </div>
    <div id="simulation-results" class="scroll-triggered">
        <!-- Results will be dynamically populated here -->
    </div>
</section>
</main>
<!-- Load Chart.js first -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Then load your twin state data -->
<script id="twin-state-data" type="application/json">
    {{ twin_state|tojson|safe }}
</script>
<!-- Load your custom scripts last -->
<script src="{{ url_for('static', filename='js/digital-twin.js') }}"></script>
<script src="{{ url_for('static', filename='js/dashboard-charts.js') }}"></script>



{% endblock %}