{% extends "base.html" %}

{% block content %}
<header class="hero">
    <div class="hero-content">
        <h1 class="hero-title">Complete Your Profile</h1>
        <p class="hero-subtitle">Provide details to personalize your EcoHealth experience.</p>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/fill_profile.css') }}">
    </div>
</header>

<main>
    <section class="profile-section">
        <h2>Profile Information</h2>
        <form id="profileForm" class="profile-form" onsubmit="submitProfile(event)">
            <!-- Basic Info -->
            <fieldset>
                <legend>Basic Info</legend>
                <label for="age">Age:</label>
                <input type="number" id="age" name="age" required><br><br>

                <label for="location">Location:</label>
                <input type="text" id="location" name="location" required><br><br>

                <label for="occupation">Occupation:</label>
                <input type="text" id="occupation" name="occupation" required><br><br>

                <label for="goals">Goals:</label>
                <div id="goals-container">
                    <input type="text" name="goals[]" placeholder="Add a goal" required>
                </div>
                <button type="button" onclick="addGoal()">Add Another Goal</button><br><br>
            </fieldset>

            <!-- Environmental Data -->
            <fieldset>
                <legend>Environmental Data</legend>
                <fieldset>
                    <legend>Transportation</legend>
                    <label for="primary_mode">Primary Mode:</label>
                    <select id="primary_mode" name="primary_mode" required>
                        <option value="">Select</option>
                        <option value="Car">Car</option>
                        <option value="Bike">Bike</option>
                        <option value="Public Transit">Public Transit</option>
                        <option value="Walking">Walking</option>
                        <option value="Other">Other</option>
                    </select><br><br>

                    <label for="miles_per_day">Miles Per Day:</label>
                    <input type="number" id="miles_per_day" name="miles_per_day" required><br><br>

                    <label for="public_transit">Public Transit:</label>
                    <select id="public_transit" name="public_transit" required>
                        <option value="">Select</option>
                        <option value="Never">Never</option>
                        <option value="Occasionally">Occasionally</option>
                        <option value="Frequently">Frequently</option>
                        <option value="Daily">Daily</option>
                    </select><br><br>

                    <label for="bike_usage">Bike Usage:</label>
                    <select id="bike_usage" name="bike_usage" required>
                        <option value="">Select</option>
                        <option value="Never">Never</option>
                        <option value="Occasionally">Occasionally</option>
                        <option value="Frequently">Frequently</option>
                        <option value="Daily">Daily</option>
                    </select><br><br>

                    <label for="walking">Walking:</label>
                    <select id="walking" name="walking" required>
                        <option value="">Select</option>
                        <option value="Never">Never</option>
                        <option value="Occasionally">Occasionally</option>
                        <option value="Frequently">Frequently</option>
                        <option value="Daily">Daily</option>
                    </select><br><br>

                    <label for="flight_frequency">Flight Frequency:</label>
                    <select id="flight_frequency" name="flight_frequency" required>
                        <option value="">Select</option>
                        <option value="Never">Never</option>
                        <option value="Occasionally">Occasionally</option>
                        <option value="Frequently">Frequently</option>
                        <option value="Monthly">Monthly</option>
                    </select><br><br>
                </fieldset>

                <fieldset>
                    <legend>Diet</legend>
                    <label for="diet_type">Type:</label>
                    <select id="diet_type" name="diet_type" required>
                        <option value="">Select</option>
                        <option value="Vegan">Vegan</option>
                        <option value="Vegetarian">Vegetarian</option>
                        <option value="Pescatarian">Pescatarian</option>
                        <option value="Omnivore">Omnivore</option>
                    </select><br><br>

                    <label for="local_food_percent">Local Food Percent:</label>
                    <input type="number" id="local_food_percent" name="local_food_percent" required><br><br>

                    <label for="waste_frequency">Waste Frequency:</label>
                    <select id="waste_frequency" name="waste_frequency" required>
                        <option value="">Select</option>
                        <option value="Never">Never</option>
                        <option value="Occasionally">Occasionally</option>
                        <option value="Frequently">Frequently</option>
                        <option value="Daily">Daily</option>
                    </select><br><br>

                    <label for="meal_planning">Meal Planning:</label>
                    <input type="checkbox" id="meal_planning" name="meal_planning"><br><br>

                    <label for="composting">Composting:</label>
                    <input type="checkbox" id="composting" name="composting"><br><br>

                    <label for="bulk_buying">Bulk Buying:</label>
                    <input type="checkbox" id="bulk_buying" name="bulk_buying"><br><br>

                    <label for="farmers_market">Farmers Market:</label>
                    <input type="checkbox" id="farmers_market" name="farmers_market"><br><br>

                    <label for="seasonal_produce">Seasonal Produce:</label>
                    <input type="checkbox" id="seasonal_produce" name="seasonal_produce"><br><br>
                </fieldset>
            </fieldset>

            <!-- Health Data -->
            <fieldset>
                <legend>Health Data</legend>
                <fieldset>
                    <legend>Exercise</legend>
                    <label for="activity_level">Activity Level:</label>
                    <select id="activity_level" name="activity_level" required>
                        <option value="">Select</option>
                        <option value="Low">Low</option>
                        <option value="Moderate">Moderate</option>
                        <option value="High">High</option>
                    </select><br><br>

                    <label for="frequency">Frequency:</label>
                    <select id="frequency" name="frequency" required>
                        <option value="">Select</option>
                        <option value="Never">Never</option>
                        <option value="Occasionally">Occasionally</option>
                        <option value="Frequently">Frequently</option>
                        <option value="Daily">Daily</option>
                    </select><br><br>

                    <label for="average_duration">Average Duration (minutes):</label>
                    <input type="number" id="average_duration" name="average_duration" required><br><br>

                    <label for="activities">Activities:</label>
                    <div id="activities-container">
                        <input type="text" name="activities[]" placeholder="Add an activity" required>
                    </div>
                    <button type="button" onclick="addActivity()">Add Another Activity</button><br><br>
                </fieldset>

                <fieldset>
                    <legend>Sleep</legend>
                    <label for="average_hours">Average Hours:</label>
                    <input type="number" step="0.1" id="average_hours" name="average_hours" required><br><br>

                    <label for="quality">Quality:</label>
                    <select id="quality" name="quality" required>
                        <option value="">Select</option>
                        <option value="Poor">Poor</option>
                        <option value="Average">Average</option>
                        <option value="Good">Good</option>
                        <option value="Excellent">Excellent</option>
                    </select><br><br>

                    <label for="schedule">Schedule:</label>
                    <input type="text" id="schedule" name="schedule" required><br><br>
                </fieldset>
            </fieldset>

            <button type="submit" class="cta-button">Submit</button>
        </form>
    </section>
</main>

<script>
    function addGoal() {
        const container = document.getElementById('goals-container');
        const input = document.createElement('input');
        input.type = 'text';
        input.name = 'goals[]';
        input.placeholder = 'Add a goal';
        input.required = true;
        container.appendChild(input);
    }

    function addActivity() {
        const container = document.getElementById('activities-container');
        const input = document.createElement('input');
        input.type = 'text';
        input.name = 'activities[]';
        input.placeholder = 'Add an activity';
        input.required = true;
        container.appendChild(input);
    }

    async function submitProfile(event) {
        event.preventDefault();

        const formData = new FormData(document.getElementById("profileForm"));
        const data = Object.fromEntries(formData.entries());
        data.goals = Array.from(document.getElementsByName("goals[]")).map(input => input.value);
        data.activities = Array.from(document.getElementsByName("activities[]")).map(input => input.value);

        try {
            const response = await fetch('/api/complete_profile', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            const result = await response.json();
            if (response.ok) {
                alert("Profile completed successfully!");
                window.location.href = "/";
            } else {
                alert("Error: " + result.error);
            }
        } catch (error) {
            alert("An error occurred. Please try again.");
        }
    }
</script>
{% endblock %}
